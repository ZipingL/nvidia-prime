#!/usr/bin/make -f
# -*- makefile -*-
#
# Copyright 2013 Canonical Ltd.
#
# Author: Alberto Milone <alberto.milone@canonical.com>


# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

PKG_name = $(shell dh_listpackages)
misc_dir := /usr/share/$(PKG_name)

%:
	dh $@ --with python3

.PHONY: regen-from-templates
regen-from-templates:
	for i in $(CURDIR)/debian/install \
	     $(CURDIR)/debian/dirs \
		 $(CURDIR)/debian/preinst \
		 $(CURDIR)/debian/postrm; do \
		sed -e 's|#PKGNAME#|$(PKG_name)|g' \
			-e "s|#MISC_DIR#|$(misc_dir)|g" \
		$$i.in > $$i; \
	done

override_dh_install:
	# Do not enable the systemd unit. The switcher will enable it on
	# demand
	dh_install -p nvidia-prime
	mkdir -p $(CURDIR)/debian/nvidia-prime/lib/systemd
	dh_systemd_enable --no-enable --name=nvidia-prime-boot

	dh_install --fail-missing -Xlib/systemd

override_dh_installinit:
	dh_installinit --noscripts

override_dh_auto_clean:
	for i in $(CURDIR)/debian/install \
	     $(CURDIR)/debian/dirs \
		 $(CURDIR)/debian/preinst \
		 $(CURDIR)/debian/postrm; do \
		rm -f $$i; \
	done

override_dh_auto_install: regen-from-templates
